<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <title>CrownForge Digital | Premium Websites in Hampton, SC</title>
  <meta name="description" content="CrownForge Digital builds fast, premium websites and maintenance plans for small businesses in Hampton, SC and surrounding communities." />

  <!-- Favicons -->
  <link rel="icon" type="image/svg+xml" href="favicon.svg?v=3" />
  <link rel="apple-touch-icon" href="logo.png?v=3" />
  <meta name="theme-color" content="#070b0a" />
  <!-- Open Graph -->
  <meta property="og:title" content="CrownForge Digital | Websites, Branding & Maintenance" />
  <meta property="og:description" content="Premium websites for small businesses — built fast. Based in Hampton, SC." />
  <meta property="og:url" content="https://www.crownforgedigital.com/" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://www.crownforgedigital.com/logo.png" />

  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <!-- Topbar -->
  <header class="topbar" data-sticky>
    <div class="container topbar__inner">
      <a class="brand" href="index.html" aria-label="CrownForge Digital Home">
        <span class="brand__mark" aria-hidden="true">
          <img src="logo.png" alt="" />
        </span>
        <span class="brand__text">
          <span class="brand__name">CrownForge</span>
          <span class="brand__sub">Digital</span>
        </span>
      </a>

      <nav class="nav" aria-label="Primary Navigation">
        <button class="nav__toggle" data-nav-toggle aria-label="Open menu">
          <span></span><span></span><span></span>
        </button>

        <div class="nav__links" data-nav-links>
          <a class="nav__link is-active" href="index.html">Home</a>
          <a class="nav__link" href="portfolio.html">Portfolio</a>
          <a class="nav__link" href="contact.html">Contact</a>
          <button class="nav__cta btn btn--gold" id="openChatTop" type="button">Request</button>
        </div>
      </nav>
    </div>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero">
      <div class="hero__bg" aria-hidden="true"></div>

      <div class="container hero__grid">
        <div class="reveal">
          <p class="kicker">Premium local websites</p>
          <h1 class="h1">Let’s forge a website that gets you <span class="gold">booked</span>.</h1>
          <p class="lead">
            We build clean, fast, mobile-first sites designed to convert local traffic into calls, texts,
            and quote requests — with an old-money emerald + gold finish.
          </p>

          <ul class="bullets">
            <li>Mobile-first + fast load</li>
            <li>Click-to-call, directions, quote requests</li>
            <li>Polished design that builds trust instantly</li>
          </ul>

          <div class="hero-actions">
            <button class="btn btn--gold" id="openChatHero" type="button">Chat & Get a Quote</button>
            <a class="btn btn--ghost" href="portfolio.html">View Portfolio</a>
          </div>

          <div class="hero__meta">
            <div class="metaCard">
              <div class="metaCard__num">3–7 days</div>
              <div class="metaCard__label">Typical launch</div>
            </div>
            <div class="metaCard">
              <div class="metaCard__num">Conversion-first</div>
              <div class="metaCard__label">Not just “pretty”</div>
            </div>
          </div>
        </div>

        <!-- Right card -->
        <div class="card reveal" style="--delay:120ms">
          <div class="card__head">
            <h2 class="h3">What we need (example)</h2>
            <p class="muted">Our concierge collects this and emails it instantly.</p>
          </div>

          <p class="example">
            “Auto shop in Hampton, SC. I need a 1–3 page site (Home/Services/Contact) with a quote form and gallery.
            Timeline: 1–2 weeks.”
          </p>

          <div class="card__actions">
            <button class="btn btn--gold btn--full" id="openChatCard" type="button">Start Quote Chat</button>
          </div>

          <p class="fineprint">
            You can also go straight to the <a href="contact.html" class="inlineLink">Contact page</a>.
          </p>
        </div>
      </div>

      <!-- Floating quick contact -->
      <a class="float" href="mailto:contactcrownforgedigital@gmail.com" aria-label="Email CrownForge">
        <span class="float__icon">✦</span>
      </a>
    </section>

    <!-- Rounded media card section -->
    <section class="section">
      <div class="container split">
        <div class="mediaCard reveal">
          <div class="mediaCard__img" aria-hidden="true"></div>
          <div class="mediaCard__body">
            <p class="muted">
              Most websites are brochures. We build a conversion path that makes it effortless for customers to call, text, or request a quote.
            </p>
            <a class="btn btn--ghost" href="contact.html">Request info</a>
          </div>
        </div>

        <div class="reveal" style="--delay:120ms">
          <h2 class="h2">Strategic. Simple. Built to scale.</h2>
          <p class="lead">
            You don’t need 12 pages. You need clarity, trust, and a frictionless booking flow.
          </p>

          <div class="pillGrid">
            <div class="pill">Fast, modern layout</div>
            <div class="pill">Clear CTA placement</div>
            <div class="pill">Review & trust sections</div>
            <div class="pill">Quote/booking forms</div>
            <div class="pill">Local SEO basics</div>
            <div class="pill">Easy updates</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <div class="container footer__bottom">
        <span class="muted">© <span id="year"></span> CrownForge Digital</span>
        <a class="btn btn--ghost" href="mailto:contactcrownforgedigital@gmail.com">contactcrownforgedigital@gmail.com</a>
        <button class="btn btn--ghost" id="openChatBottom" type="button">Chat & Get a Quote</button>
      </div>
    </footer>
  </main>

  <!-- Chat Widget -->
  <div class="chat-launch" id="chatLaunch">Chat</div>

  <div class="chat" id="chat" aria-hidden="true">
    <div class="chat-header">
      <div>
        <div class="chat-title">CrownForge Concierge</div>
        <div class="chat-sub">Tell us what you need — we’ll email a summary instantly.</div>
      </div>
      <button class="chat-close" id="chatClose" aria-label="Close">✕</button>
    </div>

    <div class="chat-actions">
      <button class="chip" data-intent="pricing">Pricing</button>
      <button class="chip" data-intent="timeline">Timeline</button>
      <button class="chip" data-intent="booking">Booking</button>
      <button class="chip" data-intent="quote">Get a quote</button>
    </div>

    <div class="chat-messages" id="chatMessages"></div>

    <div class="chat-input">
      <input id="chatText" type="text" placeholder="Type here…" autocomplete="off" />
      <button id="chatSend">Send</button>
    </div>
  </div>

  <script src="app.js"></script>

  <!-- Keep your existing concierge logic + payload format (required fields: description, businessType, email) -->
  <script>
  // -----------------------------
  // Helpers
  // -----------------------------
  const el = (id) => document.getElementById(id);

  function addMessage(role, text) {
    const wrap = document.createElement("div");
    wrap.className = "msg " + (role === "user" ? "user" : "bot");

    const email = "contactcrownforgedigital@gmail.com";

    // Make ONLY assistant/bot messages clickable (safe)
    if (role !== "user" && typeof text === "string" && text.includes(email)) {
      const parts = text.split(email);

      wrap.appendChild(document.createTextNode(parts[0]));

      const a = document.createElement("a");
      a.href = `mailto:${email}`;
      a.textContent = email;
      a.className = "emailLink";
      wrap.appendChild(a);

      wrap.appendChild(document.createTextNode(parts.slice(1).join(email)));
    } else {
      wrap.textContent = text;
    }

    el("chatMessages").appendChild(wrap);
    el("chatMessages").scrollTop = el("chatMessages").scrollHeight;
    state.transcript.push({ role, content: text });
  }

  function openChat() {
    el("chat").setAttribute("aria-hidden", "false");
    el("chat").classList.add("open");
    el("chatText").focus();
  }

  function closeChat() {
    el("chat").classList.remove("open");
    el("chat").setAttribute("aria-hidden", "true");
  }

  function looksLikeEmail(t) {
    return /[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i.test(t);
  }

  function looksLikePhone(t) {
    const digits = (t || "").replace(/\D/g, "");
    return digits.length >= 10 && digits.length <= 15;
  }

  function extractEmail(t) {
    const m = (t || "").match(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/i);
    return m ? m[0] : "";
  }

  function extractPhone(t) {
    const digits = (t || "").replace(/\D/g, "");
    return digits.length >= 10 ? digits : "";
  }

  function normalizeList(t) {
    return (t || "")
      .split(/,|\n|;|\|/g)
      .map((s) => s.trim())
      .filter(Boolean);
  }

  // -----------------------------
  // Lead state (send after: description -> business type -> email)
  // -----------------------------
  const state = {
    description: "",
    name: "",
    email: "",
    phone: "",
    location: "Hampton, SC",
    businessType: "",
    pages: [],
    features: [],
    timeline: "",
    budget: "",
    maintenance: null,
    notes: "",

    leadSent: false,
    sendAttempted: false,
    transcript: [],
  };

  const sentKey = "cfd_lead_sent_v1";
  if (localStorage.getItem(sentKey) === "1") state.leadSent = true;

  async function sendLeadIfReady() {
    if (state.leadSent) return;
    if (state.sendAttempted) return;

    // required fields (matches your /api/leads validation)
    if (!state.description) return;
    if (!state.businessType) return;
    if (!state.email) return;

    state.sendAttempted = true;

    const payload = {
      description: state.description,
      businessType: state.businessType,
      email: state.email,

      name: state.name,
      phone: state.phone,
      location: state.location,
      pages: state.pages,
      features: state.features,
      timeline: state.timeline,
      budget: state.budget,
      maintenance: state.maintenance,
      notes: state.notes,
      transcript: state.transcript,
    };

    try {
      const r = await fetch("/api/leads", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      const data = await r.json().catch(() => ({}));

      if (r.ok && data && data.ok) {
        state.leadSent = true;
        localStorage.setItem(sentKey, "1");
        addMessage("assistant", "Perfect — got it. I just emailed your details to our team. ✅");
        return;
      }

      addMessage(
        "assistant",
        "I had trouble submitting that. Please try again in a moment by typing retry — or email us directly at contactcrownforgedigital@gmail.com"
      );
    } catch (e) {
      addMessage(
        "assistant",
        "I had trouble submitting that. Please try again in a moment by typing retry — or email us directly at contactcrownforgedigital@gmail.com"
      );
    }
  }

  function nextQuestion() {
    if (state.leadSent) return;
    if (state.sendAttempted) return;

    if (!state.description) {
      addMessage("assistant", "Quickly describe what you need (example: “I need a 3-page site with a quote form and gallery”).");
      return;
    }

    if (!state.businessType) {
      addMessage("assistant", "What type of business is this? (Example: HVAC, lawn care, barber, restaurant)");
      return;
    }

    if (!state.email) {
      addMessage("assistant", "What email should we send your quote summary to?");
      return;
    }

    sendLeadIfReady();
  }

  function handleUserText(text) {
    const t = (text || "").trim();
    if (!t) return;

    addMessage("user", t);

    if (/^retry$/i.test(t)) {
      if (state.leadSent) {
        addMessage("assistant", "You’re all set — we already sent your details. ✅");
        return;
      }
      state.sendAttempted = false;
      addMessage("assistant", "Retrying now…");
      sendLeadIfReady();
      return;
    }

    // Robust parsing: allow a single message to include description + business type + email
    let working = t;

    // Extract labeled business type if present (e.g., "Business type: auto shop")
    if (!state.businessType) {
      const m = working.match(/business\s*type\s*[:\-]\s*([^\n\.]+)/i);
      if (m && m[1]) {
        state.businessType = m[1].trim();
        working = working.replace(m[0], " ");
        addMessage("assistant", `Got it — ${state.businessType}.`);
      }
    }

    // Extract email even if the message contains other text
    if (!state.email) {
      const em = extractEmail(working);
      if (em) {
        state.email = em;
        working = working.replace(em, " ");
      }
    }

    // Extract phone even if the message contains other text
    if (!state.phone) {
      const ph = extractPhone(working);
      if (ph) state.phone = ph;
    }

    // Remove any leftover labeled fragments
    working = working.replace(/email\s*[:\-]\s*[^\n]+/ig, " ");
    working = working.replace(/business\s*type\s*[:\-]\s*[^\n]+/ig, " ");

    const cleaned = working.replace(/\s+/g, " ").trim();

    // If we still need a description, use the remaining cleaned text
    if (!state.description && cleaned) {
      state.description = cleaned;
      addMessage("assistant", "Got it.");
    }

    // If business type still missing and the message is short, treat it as business type
    if (!state.businessType && t.length <= 60 && !looksLikeEmail(t) && !looksLikePhone(t)) {
      state.businessType = t;
      addMessage("assistant", `Got it — ${state.businessType}.`);
    }

    if (state.pages.length === 0 && /(home|services|contact|about|gallery|portfolio|menu|pricing|reviews)/i.test(t)) {
      state.pages = normalizeList(t);
    }

    if (state.features.length === 0) {
      if (/(quote|booking|appointment|calendar|payment|stripe|square|gallery|reviews|forms?|none|nope|no)/i.test(t)) {
        state.features = normalizeList(t);
        if (state.features.length === 0) state.features = ["None"];
      }
    }

    if (!state.timeline && /(asap|week|weeks|month|days)/i.test(t)) state.timeline = t;

    if (!looksLikeEmail(t) && !looksLikePhone(t)) {
      state.notes = (state.notes ? state.notes + " " : "") + t;
    }

    nextQuestion();
  }

  function handleIntent(intent) {
    switch (intent) {
      case "pricing":
        addMessage("assistant", "Bundles: Starter (1–3 pages), Growth (5–7 pages), plus CrownCare maintenance. Want Starter or Growth?");
        break;
      case "timeline":
        addMessage("assistant", "Typical timelines: Starter 3–7 days, Growth 7–14 days depending on content. What timeline do you need?");
        break;
      case "booking":
        addMessage("assistant", "We can add booking/appointments (Calendly or custom). What business type is this and do you need payments too?");
        break;
      case "quote":
        addMessage("assistant", "To quote you fast, tell me: what you need (description), your business type, and your email.");
        break;
      default:
        addMessage("assistant", "Tell me what you need and I’ll guide you.");
    }
  }

  // Wire UI
  el("chatLaunch").addEventListener("click", () => {
    openChat();
    if (state.transcript.length === 0) {
      addMessage("assistant", "Hey! I’m the CrownForge Concierge. Tell me what you need, and I’ll email you a quick summary.");
      nextQuestion();
    }
  });

  el("openChatTop").addEventListener("click", () => el("chatLaunch").click());
  el("openChatHero").addEventListener("click", () => el("chatLaunch").click());
  el("openChatCard").addEventListener("click", () => el("chatLaunch").click());
  el("openChatBottom").addEventListener("click", () => el("chatLaunch").click());

  el("chatClose").addEventListener("click", closeChat);

  el("chatSend").addEventListener("click", () => {
    const v = el("chatText").value;
    el("chatText").value = "";
    handleUserText(v);
  });

  el("chatText").addEventListener("keydown", (e) => {
    if (e.key === "Enter") el("chatSend").click();
  });

  document.querySelectorAll(".chip").forEach((btn) => {
    btn.addEventListener("click", () => handleIntent(btn.dataset.intent));
  });
  </script>
</body>
</html>